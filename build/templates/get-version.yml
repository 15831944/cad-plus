#Install version reading task https://marketplace.visualstudio.com/items?itemName=OneLuckiDev.json2variable

parameters:
- name: versionFile
  type: string
  default: ''

steps:

- task: oneLuckiDevJson2Variable@1
  displayName: 'Read version information'
  inputs:
    jsonFile: '${{ parameters.versionFile }}'
    shouldPrefixVariables: true
    variablePrefix: 'Version'

- task: Bash@3
  displayName: 'Write version information to variable'
  inputs:
    targetType: 'inline'
    script: |
      set +x
      let previewVersionIndex = 3
      let prodVersionIndex = 9
      let previewVersionName = Preview
      echo "##vso[task.setvariable variable=previewVersion]$(Version.Major).$(Version.Minor).$(Build.BuildId).$(Version.Revision)$previewVersionIndex"
      echo "##vso[task.setvariable variable=prodVersion]$(Version.Major).$(Version.Minor).$(Build.BuildId).$(Version.Revision)$prodVersionIndex"
      echo "##vso[task.setvariable variable=previewVersionName]$previewVersionName"