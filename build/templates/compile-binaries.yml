parameters:
- name: version
  type: string
  default: ''

variables:
- name: buildConfiguration
  value: 'Release'
- name: buildPlatform
  value: 'Any CPU'

steps:
        
  - task: PowerShell@2
    displayName: 'Set assembly version'
    inputs:
      filePath: 'build/set-assembly-version.ps1'
      arguments: '-version "${{ parameters.version }}"'

  - task: VSBuild@1
    displayName: 'Build source code and unit tests'
    inputs:
      solution: 'cad-plus.sln'
      platform: '$(BuildPlatform)'
      configuration: '$(BuildConfiguration)'

  - task: codesigning@2
    displayName: 'Signing .exe files'
    inputs:
      secureFileId: xarial-code-signing.pfx
      signCertPassword: $(CODE_SIGN_CERT_PWD)
      files: '_build/*.exe'
      timeServer: 'http://timestamp.comodoca.com'
      hashingAlgorithm: 'SHA256'
      description: 'CAD+ Toolset'